\documentclass[a4paper,11pt]{article}
\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage{graphicx}
% \usepackage{algorithmic}
% \usepackage{algorithm}
\usepackage[round]{natbib}
\usepackage{url}
\usepackage{booktabs}
\usepackage{fancybox}
\usepackage{dcolumn}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{makeidx}
\usepackage{array}
\usepackage[english,basque,spanish]{babel}
\selectlanguage{spanish}
\usepackage{ifthen}
% \usepackage{afterpage}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,shadows,babel}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{eurosym}
\input  variantes.tex

%  De https://tex.stackexchange.com/questions/117943/hyperref-footnotes-and-section-ref-colors
\makeatletter
\def\@footnotecolor{red}
\define@key{Hyp}{footnotecolor}{%
 \HyColor@HyperrefColor{#1}\@footnotecolor%
}
\def\@footnotemark{%
    \leavevmode
    \ifhmode\edef\@x@sf{\the\spacefactor}\nobreak\fi
    \stepcounter{Hfootnote}%
    \global\let\Hy@saved@currentHref\@currentHref
    \hyper@makecurrent{Hfootnote}%
    \global\let\Hy@footnote@currentHref\@currentHref
    \global\let\@currentHref\Hy@saved@currentHref
    \hyper@linkstart{footnote}{\Hy@footnote@currentHref}%
    \@makefnmark
    \hyper@linkend
    \ifhmode\spacefactor\@x@sf\fi
    \relax
  }%
  \makeatother

\hypersetup{
  colorlinks = true,
  footnotecolor = black,
  linkcolor = black,
  urlcolor = blue,
}

\def\iS{\selectlanguage{spanish}}%
\def\iB{\selectlanguage{basque}}%
\def\iE{\selectlanguage{english}}%
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\DeclareGraphicsRule{eps.gz}{epe}{eps.bb}{`gzip -d #1}

% \setkeys{Gin}{width=0.9\textwidth}

\makeindex
\title{Documentación para \texttt{EA3examen} y herramientas relacionadas}
% \author{F. Tusell}
\date{\today}

\begin{document}
\maketitle
\tableofcontents

\section{Introducción}

\texttt{EA3examen} es un conjunto de plantillas, macros en \LaTeX{} y
funciones en \textsc{R} y en \textsc{ELISP} para Emacs que buscan
facilitar la producción de exámenes multilingües con múltiples modelos
en cada idioma. Pueden utilizarse sólo partes, como las definiciones
en \LaTeX, que pueden emplearse en cualquier documento, examen o no,
en uno o en varios idiomas.

La producción de exámenes hace uso del paquete
\texttt{examdesign}\footnote{Disponible en CTAN,
  \url{http://mirror.ox.ac.uk/sites/ctan.org/macros/latex/contrib/examdesign/}.}.


\section{Modus operandi}
\label{mo}

El flujo de trabajo se recoge esquemáticamente en la
Figura~\ref{flujo}, pág.~\pageref{flujo}. El usuario prepara el fichero
maestro alternativamente en formato \texttt{.Rnw} o \texttt{.tex}. El
primer formato se emplea cuando hay material que requiere ser
procesado por R (cálculos, tablas estadísticas, gráficas. etc.).
\par\penalty-5000
Tal
material se inserta en un fichero nombrado con extensión \texttt{.Rnw}
en bloques tales como
\medskip

\noindent\texttt{<{}<>{}>=}\par
\noindent\texttt{library(MASS)}\par
\noindent\texttt{@}\par
\bigskip

\noindent en que los delimitadores \texttt{<{}<>{}>=} y \texttt{@}
señalan fragmentos de código que se ejecuta e inserta automáticamente
en un nuevo fichero en formato \LaTeX{} standard. Las variantes
idiomáticas, por su parte, se codifican señalando las líneas en cada
idioma con un prefijo, del modo siguiente:

\begin{verbatim}
ES- Estadística y probabilidad...
EN- Statistics and probability...
EU- Estatistika eta probabilitatea...
\end{verbatim}

Estas líneas se copian tal cual al fichero \texttt{.tex} al procesar
el fichero \texttt{.Rnw}. Algunas funciones en Emacs ayudan a editar
el texto variante.

En la etapa posterior, se generan las versiones para los idiomas que se
hayan configurado. Un único golpe de tecla en Emacs genera a partir
del documento precursor tantos otros como idiomas, con nombres iguales
al del precursor prefijados por el idioma (\texttt{EN.fichero.tex},
\texttt{ES.fichero.tex}, etc. Éstos son tratados como ficheros
\LaTeX{} ordinarios que son, dando lugar cada uno al documento final
en un idioma y el formato que se haya escogido, normalmente PDF.

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

\tikzstyle{input}=[draw, fill=red!20, text width=5em,
    text centered, minimum height=3em, rounded corners, drop shadow]
\tikzstyle{output}=[draw, fill=blue!20, text width=5em,
    text centered, minimum height=3em, rounded corners, drop shadow]
\tikzstyle{ba} = [input, text width=5em, fill=blue!20,
    minimum height=3em, rounded corners, drop shadow]
\def\blockdist{3.3}
\def\edgedist{2.5}
\def\interblock{2.4}

\begin{figure}
\selectlanguage{spanish}
\caption{Proceso de generación de documentos con
  \texttt{EA3examen}. El usuario genera uno de los dos ficheros en
  color salmón, mientras que los ficheros en color lavanda se generan
  automáticamente.}
\bigskip\bigskip
\label{flujo}

\begin{tikzpicture}[>=triangle 60]
\node (ba) [ba]  {\LaTeX\\ \texttt{.tex}};
\path (ba.west)+(-\interblock, 1.5) node (rnw) [input] {Sweave\\ \texttt{.Rnw}};
\path (ba.west)+(-\interblock,-1.5) node (tex) [input] {\LaTeX\\ \texttt{.tex}};
\path (ba.east)+( \interblock, 1.5) node (EN) [output] {EN \\ \texttt{.tex}};
\path (ba.east)+( \interblock, 0.0) node (ES) [output] {ES \\ \texttt{.tex}};
\path (ba.east)+( \interblock,-1.5) node (EU) [output] {EU \\ \texttt{.tex}};
\path (EN.east)+( \interblock, 0.0) node (ENpdf) [output] {EN \\ \texttt{.pdf}};
\path (ES.east)+( \interblock, 0.0) node (ESpdf) [output] {ES \\ \texttt{.pdf}};
\path (EU.east)+( \interblock, 0.0) node (EUpdf) [output] {EU \\ \texttt{.pdf}};


\path [draw, ->] (rnw.east) -- node [above] {}  (ba.175) ;
\path [draw, ->] (tex.east) -- node [above] {}  (ba.185);
\path [draw, ->] (ba.east)  -- node [left]  {}  (EN.180);
\path [draw, ->] (ba.east)  -- node [above] {}  (ES.180);
\path [draw, ->] (ba.east)  -- node [above] {}  (EU.180);
\path [draw, ->] (EN.east)  -- node [above] {}  (ENpdf.180);
\path [draw, ->] (ES.east)  -- node [above] {}  (ESpdf.180);
\path [draw, ->] (EU.east)  -- node [above] {}  (EUpdf.180);


%     \path (ba.south) +(1.5,-\blockdist) node (asrs) {Proceso generación exámenes};
    %  \begin{pgfonlayer}{background}
    %      \path (rnw.west |- rnw.north)+(-0.5,0.3) node (a) {};
    %      \path (ba.south -| ba.east)+(+0.5,-0.3) node (b) {};
    %      \path (EUpdf.east |- asrs.east)+(+0.5,-0.5) node (c) {};

    %     \path[fill=yellow!20,rounded corners, draw=black!50] %  dashed]
    %         (a) rectangle (c);
    %     \path (rnw.north west)+(-0.2,0.2) node (a) {};
    % \end{pgfonlayer}

\end{tikzpicture}
\bigskip
\end{figure}

\texttt{EA3examen} requiere una instalación razonablemente completa de
\LaTeX{} incluyendo el paquete \texttt{examdesign} y los siguientes
ficheros, con expresión de los lugares donde deben instalarse:

\begin{table}[h!]
\small
\begin{tabular}{lll}
\toprule
\textbf{Fichero} & \textbf{Ubicación} & \textbf{En Linux, típicamente:} \\
\midrule
\texttt{EA3examen.sty} & Formatos \LaTeX{}, & \verb|/usr/local/share/texmf/tex/latex|\\
%\texttt{variantes.tex} & Formatos \LaTeX{}, & \verb|/usr/local/share/texmf/tex/latex|\\
\texttt{EA3examen.el}  & Ficheros ELisp,    & \verb|/usr/local/share/emacs/site-lisp|\\
\texttt{EA3plantilla.Rnw}  & Ficheros ELisp,    & \verb|/usr/local/share/emacs/site-lisp|\\
\bottomrule
\end{tabular}
\normalsize
\end{table}

La versión más actual de los ficheros que componen \texttt{EA3examen}
puede obtenerse de GitHub\footnote{ Ver
\url{https://github.com/FernandoTusell/EA3examen}. Código abierto,
licencia GPL.}, y clonarse en
cualquier máquina equipada con Git\footnote{Ver
  \url{https://git-scm.com/.}} mediante el mandato:
\begin{center}
  \texttt{git clone git@github.com:FernandoTusell/EA3examen.git}

\end{center}


\section{Macrodefiniciones}

\subsection{Locuciones frecuentes}

Son expresiones en modo texto que se insertan a veces en una fórmula o
entre fórmulas, y constituyen los únicos elementos que requerirían
traducción. El uso de estos macros permite utilizar una única
expresión para todos los idiomas. Son frecuentes ``sí'', ``no'',
``cierto'', ``falso'' y la opción
\verb|\af| en las preguntas de elección múltiple, para
proporcionar una respuesta correcta cuando ninguna más lo es.

\begin{table}[h!]
\centering
\caption{Locuciones frecuentes}
\bigskip
\small
\begin{tabular}{@{}l@{}C{4cm}C{4cm}C{4cm}}
\toprule
 & \multicolumn{3}{c}{\textbf{Variantes idiomáticas}}  \\[1mm]
\textbf{Macro} & \textbf{Español} & \textbf{Euskera} & \textbf{Inglés} \\
\midrule
\verb|\af|      & \iS\parbox[c]{1.25in}{\af}
                & \iB  \parbox[c]{1.25in}{\af}
                & \iE \parbox[c]{1.25in}{\af}   \\[3mm]
\verb|\casicero|  & \iS\casicero & \iB \casicero  & \iE \casicero    \\
\verb|\cierto|  & \iS\cierto & \iB \cierto  & \iE \cierto    \\
\verb|\falso|   & \iS\falso  & \iB \falso   & \iE \falso     \\[1mm]
\verb|\nunca|   & \iS\nunca  & \iB \nunca   & \iE \nunca     \\[1mm]
\verb|\ii|      & \iS\parbox[c]{1.25in}{\ii}
                & \iB  \parbox[c]{1.25in}{\ii}
                & \iE \parbox[c]{1.25in}{\ii}   \\[3mm]
\verb|\no   |   & \iS\no     & \iB \no      & \iE \no \\
\verb|\Sesgo|   & \iS\Sesgo  & \iB \Sesgo   & \iE \Sesgo \\
\verb|\si   |   & \iS\si     & \iB \si      & \iE \si \\
\verb|\sif   |   & \iS\sif     & \iB \sif      & \iE \sif \\
\verb|\Sif   |   & \iS\Sif     & \iB \Sif      & \iE \Sif \\
\verb|\Sifthen{a}{b}   |   & \iS \parbox[c]{1.25in}{\Sifthen{a}{b}}
                           & \iB \parbox[c]{1.25in}{\Sifthen{a}{b}}
                           & \iE \parbox[c]{1.25in}{\Sifthen{a}{b}} \\

\verb|\Var|     & \iS\Var    & \iB \Var     & \iE \Var   \\
\verb|\Y|       & \iS\Y      & \iB \Y       & \iE \Y     \\
\bottomrule
\end{tabular}
\normalsize
\end{table}

\subsection{Notación matemática}

\paragraph{Constantes.}
Constantes de uso frecuente como parte de expresiones.

\begin{table}[h!]
\centering
\caption{Constantes frecuentes}
\bigskip
\small
\begin{tabular}{@{}r@{}C{2.5cm}C{2.5cm}C{2.5cm}}
\toprule
 & \multicolumn{3}{c}{\textbf{Variantes idiomáticas}}  \\[1mm]
\textbf{Macro} & \textbf{Español} & \textbf{Euskera} & \textbf{Inglés} \\
\midrule
\verb|\oh|       & \iS\oh  & \iB\oh   & \iE\oh    \\[1mm]
\verb|\rdpi|       & \iS\rdpi  & \iB\rdpi   & \iE\rdpi    \\
\bottomrule
\end{tabular}
\normalsize
\end{table}


\paragraph{Estimadores.}
\label{estimadores}
El macro \verb|\est| no está destinado a ser invocado directamente,
aunque puede serlo. Sirve como base a \verb|\emv| y similares, que
tienen variantes idiomáticas.

\begin{table}[h!]
\centering
\caption{Estimadores frecuentes}
\bigskip
\small
\begin{tabular}{@{}r@{}C{2.5cm}C{2.5cm}C{2.5cm}}
\toprule
 & \multicolumn{3}{c}{\textbf{Variantes idiomáticas}}  \\[1mm]
\textbf{Macro} & \textbf{Español} & \textbf{Euskera} & \textbf{Inglés} \\
\midrule
\verb|\est{a}{b}|   & \iS\est{a}{b}  & \iB\est{a}{b}   & \iE\est{a}{b}   \\
\verb|\emv{\theta}|   & \iS\emv{\theta}  & \iB\emv{\theta}   & \iE\emv{\theta}   \\
\verb|\emom{\theta}|  & \iS\emom{\theta} & \iB\emom{\theta}  & \iE\emom{\theta}   \\
\bottomrule
\end{tabular}
\normalsize
\end{table}

La macro  \verb|\est| y sus derivados están previstos para emplearse
sobre expresiones simples, sobre las que pueda ponerse fácilmente un
acento circunflejo. En ocasiones habrá que recurrir a dejar parte de
la expresión que se estima fuera del argumento. Véase por ejemplo la
diferencia entre estas dos formas de escribir el estimador máximo
verosímil de $\sigma^2$:
\bigskip

\begin{tabular}[h!]{lc@{$\Rightarrow$}cl}
\verb|El estimador \emv{\sigma^2}...| &&& El estimador $\emv{\sigma^2}\ldots$ \\
\verb|El estimador \emv{\sigma}^2...| &&& El estimador $\emv{\sigma}^2\ldots$ \\
\end{tabular}

\paragraph{Funciones y expresiones.}
\mbox{ }
\begin{table}[htb]
\centering
\caption{Funciones y expresiones frecuentes}
\bigskip
\small
\begin{tabular}{@{}r@{}C{2.5cm}C{2.5cm}C{2.5cm}}
\toprule
 & \multicolumn{3}{c}{\textbf{Variantes idiomáticas}}  \\[1mm]
\textbf{Macro} & \textbf{Español} & \textbf{Euskera} & \textbf{Inglés} \\
\midrule
\verb|\f{x}|       & \iS\f{x}  & \iB\f{x}   & \iE\f{x}   \\
\verb|\F{x}|       & \iS\F{x}  & \iB\F{x}   & \iE\F{x}   \\
\verb|\FisherInf{\theta}|       & \iS\FisherInf{\theta}  & \iB\FisherInf{\theta}   & \iE\FisherInf{\theta}   \\
\verb|\charf{x}|    & \iS\charf{x}  & \iB\charf{x}   & \iE\charf{x}   \\
\verb|\momg{x}|    & \iS\momg{x}  & \iB\momg{x}   & \iE\momg{x}   \\
\verb|\ecm{\hat\theta}| & \iS\ecm{\hat{\theta}} & \iB\ecm{\hat{\theta}} & \iE\ecm{\hat{\theta}} \\
\verb|\puntuacion{1}{5}| & \iS\puntuacion{1}{5} & \iB\puntuacion{1}{5} & \iE\puntuacion{1}{5} \\
\bottomrule
\end{tabular}
\normalsize
\end{table}

\index{macros!ecm@\texttt{ecm}}
\index{macros!momg@\texttt{momg}}
\index{macros!charf@\texttt{charf}}
\index{macros!f@\texttt{f}}
% \index{macros!F@\texttt{F}\;[\f{x}]}

Como argumento de \verb|ecm| se pueden
insertar cualesquiera estimadores de los definidos en la
subsección~\ref{estimadores}. Por ejemplo, podemos escribir:
\bigskip

\selectlanguage{spanish}
\small
\noindent\begin{tabular}[l]{lp{0.5cm}l}
El \verb|\ecm{\emv{\theta}}| es$\ldots$  &  & El \ecm{\emv{\theta}}
es$\ldots$ \\[3mm]
\verb|\ecm{\emv{\pi}} = \ecm{\emom{\pi}}| & & $\ecm{\emv{\pi}}
= \ecm{\emom{\pi}}$ \\[3mm]
\verb|\ecm{\hat\pi} =|& & $\ecm{\hat\pi} =
  \Sesgo(\hat\pi) + \Var(\hat\pi)$ \\
\qquad \verb|\Sesgo(\hat\pi) + \Var(\hat\pi)|  \\
\end{tabular}
\normalsize


\paragraph{Límites, convergencias, distribuciones asintóticas}
Un macro general, \verb|\anylim{texto}| sitúa ``texto'' sobre una flecha
hacia la derecha. No está destinado a ser invocado directamente,
aunque puede serlo. Hay especializaciones para límites en distribución,
probabilidad y casi seguros (o ``con probabilidad unitaria'') que
tienen variantes idiomáticas..

El macro \verb|\dist{texto}| sitúa ``texto'' sobre el símbolo
habitualmente utilizado para ``se distribuye como''. Especializaciones
son \verb|\asin| (= \verb|\dist{a}|) para indicar distribución
asintótica
 y \verb|\diid| (= \verb|\dist{\iid}|)
para indicar ``independientes y con idéntica distribución''.
\begin{table}[h!]
\centering
\caption{Límites, convergencias y distribuciones asintóticas}
\bigskip
\small
\begin{tabular}{@{}r@{}C{2.5cm}C{2.5cm}C{2.5cm}}
\toprule
 & \multicolumn{3}{c}{\textbf{Variantes idiomáticas}}  \\[1mm]
\textbf{Macro} & \textbf{Español} & \textbf{Euskera} & \textbf{Inglés} \\
\midrule
\verb|\anylim{texto}|       & \iS\anylim{texto}  & \iB\anylim{texto}   & \iE\anylim{texto}    \\
\verb|\dlim|    & \iS\dlim  & \iB \dlim  & \iE \dlim \\
\verb|\plim|    & \iS\plim  & \iB \plim  & \iE \plim \\
\verb|\cslim|   & \iS\cslim & \iB \cslim & \iE \cslim \\
\verb|\dist{xxx}|   & \iS\dist{xxx} & \iB \dist{xxx} & \iE\dist{xxx} \\
\verb|\asint|   & \iS\asin  & \iB\asin & \iE\asin \\
\verb|\diid|    & \iS\diid  & \iB\diid & \iE\diid \\
\bottomrule
\end{tabular}
\normalsize
\end{table}

\newpage
\section{Exámenes para Moodle (= e-Gela)}

\subsection{Ex-novo}

\subsubsection{Paquete \LaTeX2e{} \texttt{moodle}.}

Si se puede partir desde cero, la forma más simple que he encontrado
consiste en emplear un formato distinto a \texttt{examdesign} junto
con el paquete \texttt{moodle}\footnote{Ver
  \url{http://tug.ctan.org/macros/latex/contrib/moodle/moodle.pdf}.
  Paquete disponible en CTAN.}. El uso es muy simple. Para preguntas
de elección múltiple, emplearíamos algo como:
\bigskip

\cornersize{.07}
\lstdefinestyle{customc}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=L,
  xleftmargin=\parindent,
  language=C,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
}
\Ovalbox{\lstinputlisting{examen.tex}}
\bigskip
\par\penalty-5000

Al procesar un fichero como el precedente (que guardaremos con
extensión \texttt{.tex}) mediante

\begin{verbatim}
pdflatex examen.tex
\end{verbatim}
obtenemos un fichero en \texttt{examen.pdf} con las soluciones marcadas (que puede
servirnos para verificar que todo está bien) y, además, un fichero de
nombre \texttt{examen-moodle.xlm} en XML con la apariencia siguiente:
\bigskip

\Ovalbox{\lstinputlisting{examen-moodle.xml}}
\bigskip

Este fichero, que puede contener muchas cuestiones, es el que puede
importarse en Moodle empleando la opción de importación en XML.

\emph{Podríamos} emplear un procedimiento análogo al seguido en las
secciones precedentes para generar ficheros en distintos lenguajes;
pero no podemos emplear \texttt{examdesign} ni los macros en
\texttt{EA3examen}, porque Moodle no los interpretará.

\subsubsection{A partir de una hoja Excel}

Este método será de utilidad a usuarios que no necesiten hacer gran
uso de notación matemática y trabajen en entornos con R. Se debe a
Randy Cragun, y puede encontrarse documentado en
\href{https://moodle.org/pluginfile.php/134/mod_forum/attachment/1607262/MoodleQBankScript.pdf?forcedownload=1}{aquí}. El
autor ofrece también
\href{https://moodle.org/pluginfile.php/134/mod_forum/attachment/1607261/QExamples.xlsx?forcedownload=1}{una
  hoja Excel con preguntas de muestra} así como
\href{https://moodle.org/pluginfile.php/134/mod_forum/attachment/1607261/MoodleQ_2020-03-17.R?forcedownload=1}{la
  fuente del programa en R para hacer la conversión.}\footnote{Todos
  los enlaces visitados el 3 mayo 2020.}

\subsection{A partir de exámenes pre-existentes}

Si se desea aprovechar un examen pre-existente en el formato
\texttt{examdesign} que por bastantes años hemos venido empleando,
puede hacerse mediante el procedimiento que se bosqueja a continuación.


Este procedimiento tiene la ventaja de generar \emph{a la vez}
formularios de examen sobre papel para administrar un examen
convencional y fuente en XML para importar a un banco de preguntas en Moodle.
Tiene no obstante muchos inconvenientes:
\begin{enumerate}
\item Emplea herramientas de software auxiliares que pueden no existir o ser
difíciles de instalar o sustituir en Windows\footnote{Aunque son
  standard en Debian Linux, por ejemplo.}.
\item Si se emplean macros en las cuestiones para recoger variaciones
  lingüísticas, hay que reemplazarlos antes de dar el paso de \LaTeX{}
  a XML.
\item Es preciso emplear codificación de caracteres UTF-8; Moodle no
  admitirá otra cosa.
\item No podremos emplear la ventaja de incluir figuras generadas ``al
  vuelo'' mediante la inclusión de código R en el fichero
  \texttt{.Rnw}, ni tampoco (en algunos casos) código. En particular, el símbolo
  \texttt{<} no será utilizable en una expresión como
\begin{verbatim}
     a <- 4
\end{verbatim}
  porque en XML los caracteres \texttt{<} y \texttt{>} tienen uso
  especial. (Pero puede emplearse = en lugar de <-.)
\item Normalmente será preciso retocar el resultado manualmente. Es un
proceso frágil.
\end{enumerate}

\par\penalty-5000
\noindent Si, pese a todo, se desea seguir esta vía, el modo de hacerlo es el
siguiente:

\begin{enumerate}
\item Generar, siguiendo el procedimiento descrito en la
  Sección~\ref{mo}, versiones \texttt{.tex} en todos los idiomas
  requeridos. En lo que sigue, se describe el modo de actuar con
  el fichero \texttt{EN.examen.tex}; debe hacerse lo propio con
  cada uno de los otros idiomas.

  Este examen no debe contener bloques de cuestiones o figuras. Si se
  desea agrupar cuestiones por temas en el banco de preguntas a crear
  en Moodle, se puede emplear en Emacs el menú \textsc{EA3 -> Añadir
    categoría} con el cursor en cualquier lugar de la cuestión que se
  quiera categorizar. El editor entonces añade una etiqueta como
\begin{verbatim}
   %%%cat: Estimación máximo verosímil %%%
\end{verbatim}
  inmediatamente precediendo a la cuestión.
\item Procesar el fichero \texttt{EN.examen.tex} corriendo sobre él
  el programa \texttt{moodleiza}:
\begin{verbatim}
   moodleiza  EN.examen.tex
\end{verbatim}
Esto produce en el directorio de trabajo varios nuevos ficheros, de
entre los cuales \texttt{EN.examen-clean.xml} es el que nos
interesa. Está en formato XML y permite, si carece de errores,
su importación directa a Moodle\footnote{El modo de realizarla sed
  detalla en \url{https://docs.moodle.org/38/en/Moodle_XML_format}.}.
\item Verificar la existencia de errores antes de intentar la
  importación a Moodle. Un modo de hacerlo es invocar Emacs sobre el
  fichero  \texttt{EN.examen-clean.xml} y en el menú \texttt{XML}
  pinchar \texttt{Next error} para ver los errores que puedan existir.
  En la medida de lo posible, estos errores se deben solucionar
  ``aguas arriba'', en el fichero \texttt{.Rnw} si es posible, de
  manera que queden solucionados para todas las versiones que se
  generen a partir del mismo.
\end{enumerate}

\index{Moodle!moodleiza@\texttt{moodleiza}}
\noindent El programa \texttt{moodleiza} invoca otros varios, que deben
  estar instalados y hace implícitamente supuestos sobre la fuente. En
  particular, las respuestas deben estar en el modo en que las inserta
  Emacs cuando pulsamos \texttt{F4}:
\begin{verbatim}
     \choice{
        Texto respuesta
     }
\end{verbatim}
  de forma que \texttt{moodleiza} pueda detectar inambiguamente el
  comienzo y el final. Podría causar un error algo como:
\begin{verbatim}
     \choice{
        Texto respuesta
     } \choice{
        Otra respuesta
     }
\end{verbatim}
a pesar de que ello no originaría problemas al producir el examen en
\LaTeX.

\appendix
\newpage
\section{Descripción de operaciones que realiza \texttt{moodleiza}.}

(Esta Sección debiera ser innecesaria, pero saber las
transformaciones que realiza \texttt{moodleiza} puede ayudar a
diagnosticar problemas cuando algo va mal, o incluso realizar tales
transformaciones manualmente de una en una, para ver dónde se produce
el fallo.)

Las operaciones que es preciso realizar sobre el fichero
\texttt{EN.examen.tex} son las siguientes:

\begin{enumerate}
\item Expandir todos los macros que hayamos empleado para introducir
  variantes lingüísticas, de forma que una línea tal como:
\begin{verbatim}
     $X_n\plim a$
\end{verbatim}
  quede reemplazada (en la versión inglesa) por
\begin{verbatim}
     $X_n {\buildrel p \over\longrightarrow} a$
\end{verbatim}
  Esto es necesario porque \verb|\plim| (y otros muchos) son macros
  privados nuestros, que Moodle no reconocerá.

  Para obtener esta expansión de macros necesitamos disponer de sus
  definiciones (las llamaremos \texttt{EN.macros-private.sty}; ha de
  existir un tal fichero por idioma, y necesariamente el nombre ha de
  terminar en \texttt{-private.sty})\footnote{Este
    fichero ha de estar creado. No puede obtenerse directamente de
    \texttt{EA3examen.sty}, como podría imaginarse: en
    \texttt{EN.macros-private.sty} y análogos en otros idiomas, los macros
    han de estar definidos mediante \texttt{newcommand} o
    \texttt{renewcommand}; en \texttt{EA3examen.sty} han de estar
    definidos mediante \texttt{def}.}. Se inserta
  en la cabecera de \texttt{EN.examen.tex} una línea:
\begin{verbatim}
     \usepackage{EN.macros-private}
\end{verbatim}
  y se elimina \verb|\usepackage{EA3examen}| (pues las definiciones
  alternativas de los mismos macros, mutuamente se machacan).
  Esta sustitución la hace \texttt{moodleiza} invocando el editor de
  flujo \texttt{sed}\footnote{Presente en toda instalación
    Unix/Linux.}.

  Para ficheros fuente en otros idiomas se reemplaza la
  línea de macros que corresponda (como
  \texttt{ES.macros-private.sty} o
  \texttt{EU.macros-private.sty}). La detección del lenguaje del
  fichero se efectúa examinando la configuración del paquete
  \texttt{babel} (en particular, la línea \verb|\selectlanguage{<idioma>}|).

  \index{macros!privados!sustitución mediante \texttt{de-macro}}
  \index{de-macro@\texttt{de-macro}}
  A continuación se ejecuta:
\begin{verbatim}
     de-macro  EN.examen
\end{verbatim}
  Obsérvese que no se incluye la extensión \texttt{.tex}.
  El ejecutable
\texttt{de-macro}
 es un programa en Python\footnote{Por
tanto, debe existir un interprete de Python en la máquina
en que trabajamos, algo habitual en maquinas Linux; además,
para la versión de \texttt{de-macro} incluida en el paquete
\texttt{texlive-extra-utils} de Debian 10 (y probablemente de
derivadas contemporáneas, como Ubuntu, etc.) ha de ser
la versión 2.6 o anterior. Modernamente (2021) \texttt{de-macro} ha desaparecido
de \texttt{texlive-extra-utils} y procede directamente de
\url{https://ctan.org/pkg/de-macro}, instalándose en máquinas Linux en
el directorio \texttt{/usr/local/bin}. Ello hace el mantenimiento más
difícil; a cambio se tiene la ventaja de que la versión de Python
puede ser la 2.7 ó la 3.}.
 El output de
  \texttt{de-macro} es un fichero de nombre
  \texttt{EN.examen-clean.tex}.
\index{codificación!ISO-8859-1}
\index{codificación!UTF-8}
\index{codificación!uso\@recode}
\item Convertir el fichero  \texttt{EN.examen-clean.tex} a codificación
  UTF-8 si la original era otra (supondremos en lo que sigue que
  era ISO-8859-1, también conocida como \texttt{latin1}).
  \par\penalty-5000
  En Linux, esto puede hacerse mediante
  el mandato:
\begin{verbatim}
     recode latin1..utf8  EN.examen-clean.tex
\end{verbatim}
  que \textbf{sobreescribe} el fichero
  original\footnote{\texttt{recode} es un programa habitual en
    instalaciones Linux. En Debian/Ubuntu se encuentra en el paquete
    del mismo nombre.}.

%   A continuación, se
%   edita reemplazando en las primeras líneas:
% \begin{verbatim}
% % -*- coding: iso-8859-15 -*-
% \end{verbatim}
%   por:
% \begin{verbatim}
% % -*- coding: utf-8 -*-
% \end{verbatim}
%   y:
% \begin{verbatim}
% \usepackage[latin1]{inputenc}
% \end{verbatim}
%   por:
% \begin{verbatim}
% \usepackage[utf8]{inputenc}
% \end{verbatim}

\index{Moodle!exam2moodle.pl@\texttt{exam2moodle.pl}}
\item Correr el programa \texttt{exam2moodle.pl} sobre el fichero
  \texttt{EN.examen-clean.tex} obtenido en el paso
  precedente\footnote{\texttt{exam2moodle.pl} es un programa muy
    simple escrito en Perl. Debe existir un intérprete de Perl en la
    máquina, algo  standard en máquinas Linux.}.
\begin{verbatim}
     exam2mooddle.pl  EN.examen.tex
\end{verbatim}
  Dicho
  programa cambia el formato de las cuestiones, del propio de
  \texttt{examdesign} al formato XML que Moodle requiere para
  importación a su banco de cuestiones. Dejará en el directorio en el
  que estamos trabajando un nuevo fichero \texttt{EN.examen-clean.xml}. Este
  fichero es el que se importa por Moodle, comprobando
  primero\footnote{Con Emacs, por ejemplo.} la inexistencia de errores
  sintácticos, en presencia de los cuales la importación fallaría.

  Es de notar que el output que produce \texttt{exam2moodle} tiene muy
  mal aspecto. En particular, tiene que saltar sobre peculiaridades
  del formato Cloze en Moodle, que hace que en algunos contextos ---no
  en todos--- el caracter \} deba escaparse en las fórmulas en \LaTeX,
  reemplazándolo por $\backslash\}$.
  (Curiosamente, \{ no lo requiere.)
\end{enumerate}

\newpage
\section{Normas de estilo}

Lo fundamental es la claridad e inambigüedad. A ello ayudan una
sintaxis y ortografía irreprochables. Adicionalmente, si podemos
hacerlo sin complicaciones excesivas, conviene respetar las
convenciones y prácticas establecidad en cada lengua.


\subsection{Uso de unidades físicas}
\index{unidades!abreviaturas}
\paragraph{En euskera:}
\paragraph{En español:} Las unidades se escriben sin punto al final cuando se emplea el nombre
abreviado, y no tienen plural: cl, kg, t por centilitro, kilogramo,
tonelada. (ver \cite{ramoneda-98}, p.~322).

En derogación parcial de la norma anterior prevalece el convenio de emplear abreviaturas de unidades con
mayúsculas cuanto derivan del nombre propio de personas: A por amperio
(Ampère), Hz por hertzio (Hertz), V por voltio (Volta), C para la
escala centígrada y F para la escala Farenheit (Celsius, Farenheit),
etc.

También se emplean mayúsculas para algunos múltiplos en el sistema
métrico decimal que podrían confundirse (M=mega, para con confindir
con m=mili, D=deca para distinguir de d=deci, etc.) Por algún motivo
se escribe también con frecuencia Tm (tonelada métrica) y Hl (hectolitro).

Las abreviaturas de unidades se emplean
únicamente con magnitudes expresadas numéricamente: 5~gr, 6~kg, 3~t,
pero no cinco gr, seis kg, siete t.

No se permite que la cifra y la abreviatura de unidad queden en
diferente línea. Para evitarlo puede utilizarse el ``espacio
irrompible'', \texttt{\~}, escribiendo por ejemplo \texttt{5\~{}gr} en
lugar de \texttt{5 gr}.

\paragraph{En inglés:} La misma regla prevalece en inglés.
(ver \cite{Chicago:14}, \S~8.15)
\medskip



Aunque difícilmente será el caso en nuestros exámenes, el uso repetido
de unidades puede hacer aconsejable el uso de paquetes especializados,
como \href{https://ctan.org/pkg/siunitx}{siunitx}, o
\href{https://ctan.org/pkg/siunits}{siunits,} si de lo que se trata es
de unidades físicas.

\subsection{Uso de unidades monetarias}

\paragraph{En euskera:}
\paragraph{En español:}
En el caso de unidades monetarias, cuando no se emplean símbolos
especiales como \$, \euro{} o \pounds, las unidades se escriben
en mayúsculas: EUR, GBP (ver
\href{https://publications.europa.eu/code/en/en-370303.htm}{Interinstitutional
  Style Guide}). En nuestros exámenes solo manejaremos \euro{} y sólo
detrás de la cifra:

\bigskip
\begin{tabular}[h!]{lc@{$\Rightarrow$}cl}
\verb|La cantidad de 30\euro...   | &&& La cantidad de 30\euro{} \\
\end{tabular}
\bigskip

\noindent\texttt{$\backslash$euro} esta definido en el paquete \texttt{eurosym} que hay
que cargar con un \texttt{$\backslash$usepackage\{eurosym\}}. Puede ser útil
también en el caso de varias monedas el paquete
\href{https://ctan.org/pkg/currency}{currency}.

\paragraph{En inglés:} Son admisibles las reglas mencionadas para el
español, aunque es convencional poner el símbolo  \pounds\ antes de
la cifra: \pounds30, en lugar de 30\pounds.

\subsection{Puntuación en enumeraciones}
\index{puntuación!enumeraciones}
\paragraph{En euskera:}
\paragraph{En español:} Seguiremos el mismo criterio que en inglés, al
menos para locuciones cortas que no sean oraciones completas. Frases
largas o más de una parecen exigir un punto al final.
\paragraph{En inglés:} En enumeraciones en ``outline style'' (cada
ítem precedido de un numeral y comenzando una línea), no se ponen
puntos al final (\cite{Chicago:14}, \S~8.76). Así, en el caso de las
respuestas a una cuestión escribiremos:
\begin{enumerate}
\item[(a)] Primera respuesta
\item[(b)] Segunda respuesta
  \par
  $\vdots$
\end{enumerate}
en lugar de
\begin{enumerate}
\item[(a)] Primera respuesta.
\item[(b)] Segunda respuesta.
  \par
  $\vdots$
\end{enumerate}

\subsection{Puntuación en frases conteniendo fórmulas}
\index{puntuación!frases conteniendo fórmulas}
\paragraph{En euskera:}
\paragraph{En español:}
\paragraph{En inglés:} Cuando una fórmula está sóla en una línea, la
frase precedente no usa puntuación especial; usa la misma que
hubiéramos empleado de escribir todo seguido ---que puede ser
ninguna---. Por ejemplo, \cite{knuth-larrabee-roberts-89} \S~2-23
desaconsejan el uso de {\color{red}\textbf{:}} en
\begin{quotation}
  We shall be interested in the subset of vectors{\color{red}\textbf{:}}
  $$A_n = \{(a_1,\ldots,a_n) \in N^n\; |\; a_1 \ge \ldots \ge a_n\}$$
\end{quotation}
propugnando en cambio
\begin{quotation}
  We shall be interested in the subset of vectors
  $$A_n = \{(a_1,\ldots,a_n) \in N^n\; |\, a_1 \ge \ldots \ge a_n\}$$
\end{quotation}
o empleando a lo sumo una coma tras ``vectors''.




\newpage
\section{Utilización de Emacs}

Todos los macros y funciones de edición han sido escritos para Emacs,
que es también la ``cola'' que cementa todo el procedimiento.

Sobre Emacs hay muchos tutoriales y documentación on-line, fácilmente
localizable.  Libros útiles son: \cite{Cameron-rosenblatt:91}, muy
elemental; \cite{Stallman:97}, \cite{petersen-15}, \cite{hahn-16}, más
completos; \cite{Glickstein:95}, \cite{Chassell:95}, más avanzados, no
sobre uso del editor, sino sobre cómo extenderlo mediante
programación.

Entre los recursos disponibles en Internet está el excelente
\href{https://sachachua.com/blog/}{blog de Sacha Chua}


\newpage
\section{Licencias}
Todo el software de terceros mencionado es propiedad de sus
autores, licenciado en diferentes términos. Es nuestra creencia que
el uso que hacemos del mismo no infringe ningún copyright.

Lo que hemos escrito nosotros (\texttt{moodleiza},
\texttt{exam2moodle.pl}, macros para \LaTeX2e y para Emacs) es de
fuente libre bajo licencia GPL, y puede obtenerse del repositorio
GitHub mencionado más arriba.

Cualesquiera adiciones y mejoras, se ruega se suban como ``pull
requests'' a dicho repositorio, para su eventual integración y
beneficio de otros posibles usuarios con las mismas necesidades.

\newpage
\printindex

\newpage
\bibliographystyle{abbrvnat}
\bibliography{abrev,conjunta}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
